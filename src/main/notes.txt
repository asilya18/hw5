mКАК СООБЩЕНИЯ ПЕРЕДАЮТСЯ МЕЖДУ КЛИЕНТОМ И СЕРВЕРОМ

данные через сокет идут как поток байтов.

пользователь пишет сообщение , кодирует его в байты в utf-8.
также он добавляет к этим байтам заголовок длины (2 байта).
заголовок длины добавляется , чтобы получатель (сервер или клиент)
мог определить границы сообщения в потоке байтов.
длина сообщения хранится в двух байтах: сначала младший байт числа длины,
потом старший.
далее уже в таком виде сообщение отправляется серверу.

сервер принимает эти байты , декодирует их для того чтобы ,
например , добавить имя пользователя. потом обновленное сообщение сервер
снова превращает в байты utf-8 , также добавляет длину и уже потом
отправляет всем пользователям.


1) chatServer
сначала запускается сервер,
запрашивает порт сервера,
инициализируем сервер на этом порту,
в случае некорректного порта снова
запрашивает порт.

с помощью метода
accept() сервер блокируется и ждет нового клиента.
как только клиент появляется,
сервер создает clientHandler
(если не превышено число клиентов).

создается и запускается новый поток
обработчика клиента.

2) clientHandler
работает уже чисто на сокетах.
обработчик запрашивает имя,
обьявляет о новом участнике
всему чату.
обрабатывает сообщения
и отправляет в чат.
аналогично обрабатывает выход
клиента из чата и закрывает его сокет.
метод send() логирует действие серверу
в то время как сообщение отправлено
конкретному клиенту.
метод broadcast() отправляет
сообщения всему чату.


3) chatClient
запускаем клиент.
запускаем чтение и запись сообщений по чату.

метод connectToServer() -
подключаемся к серверу.
создаем сокет по этому адресу и порту.
создаем потоки чтения и записи.

метод authenticate() -
печатаем сообщение сервера с запросом имени,
получаем имя клиента и отпправляем на сервер.

метод startMessageReader() -
демон-поток, слушатель сообщений.
создаем новый поток
и определяем его поведение:
пока клиент подключен -
он слушает сервер и читает все его
сообщения.

метод startMessageWriter() -
обрабатывает отправляемые
на сервер сообщения.

метод disconnect()
отключение клиента от чата.



┌───────────────────────────┐
│         main()            │
│  запускает start()        │
└─────────────┬─────────────┘
              │
              ▼
   ┌───────────────────────┐
   │ startMessageReader()  │
   │ поток чтения          │
   │ setDaemon(true)       │
   │ → ждёт сообщения      │
   └───────────┬───────────┘
               │
               ▼
   ┌───────────────────────┐
   │ startMessageWriter()  │
   │ поток записи (основной│
   │ в main)               │
   │ → читает ввод из конс.│
   │ → отправляет серверу  │
   │ → exit → disconnect() │
   └───────────┬───────────┘
               │
               ▼
   ┌───────────────────────┐
   │ disconnect()          │
   │ закрывает сокет       │
   │ ставит connected=false│
   └───────────┬───────────┘
               │
               ▼
   ┌───────────────────────┐
   │ Завершение main()     │
   │                       │
   │ Демон‑поток чтения    │
   │ автоматически умирает │
   │ вместе с JVM          │
   └───────────────────────┘


mvn compile exec:java -Pclient

mvn compile exec:java -Pserver


2 пункт Swing

Первое окно: ввод адреса и порта.

Второе окно: ввод имени пользователя.

Основное окно: чат (область сообщений + поле ввода + кнопка отправки).


3 пункт добавление протокола сообщений и комнат

Протокол сообщений — это набор правил, по которым клиент и сервер общаются.
Без протокола сервер получает просто текст и не понимает:
это имя, команда, или обычное сообщение.

Протокол вводит специальные ключевые слова (команды),
чтобы сервер и клиент могли различать типы сообщений:

CREATE roomName → создать комнату

JOIN roomName → присоединиться к комнате

MESSAGE text → отправить сообщение в комнату

EXIT → выйти

SYSTEM text → системное уведомление от сервера